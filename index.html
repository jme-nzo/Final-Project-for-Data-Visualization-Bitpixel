<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BITPIXEL - Retro Crypto Dashboard</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Lucide Icons (Vanilla JS version) -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <!-- Custom Styles -->
    <style>
        .video-overlay {
          position: fixed;
          inset: 0;
          z-index: 100;
          background-color: #10285A;
          display: flex;
          align-items: center;
          justify-content: center;
          transition: opacity 1s ease-in-out;
        }
        .video-overlay.fading {
          opacity: 0;
          pointer-events: none;
        }
        .video-overlay video {
          width: 100%;
          height: 100%;
          object-fit: cover;
        }
    </style>

    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    
    <!-- Babel -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
</head>
<body class="bg-[#D6C9A9]">
    <div id="root"></div>

    <script type="text/babel">
        // --- 1. SETUP & UTILS ---
        const { useState, useEffect, useMemo, useRef } = React;

        // --- 2. ICON SYSTEM (Fixes imports) ---
        // This helper converts Lucide icons to React components automatically
        const Icon = ({ name, size = 24, color = "currentColor", ...props }) => {
            // Convert kebab-case to PascalCase for Lucide lookup
            const pascalName = name.replace(/(^\w|-\w)/g, (clear) => clear.replace(/-/, "").toUpperCase());
            const iconData = lucide.icons[name] || lucide.icons[pascalName];
            
            if (!iconData) {
                console.warn(`Icon not found: ${name} (tried ${pascalName})`);
                return null;
            }
            return (
                <svg
                    width={size}
                    height={size}
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke={color}
                    strokeWidth="2"
                    strokeLinecap="round"
                    strokeLinejoin="round"
                    {...props}
                >
                    {iconData.map(([tag, attrs], i) => React.createElement(tag, { ...attrs, key: i }))}
                </svg>
            );
        };

        // Define the icons used in your code
        const LineChart = (p) => <Icon name="line-chart" {...p} />;
        const BarChart2 = (p) => <Icon name="bar-chart-2" {...p} />;
        const Wallet = (p) => <Icon name="wallet" {...p} />;
        const ArrowRightLeft = (p) => <Icon name="arrow-right-left" {...p} />;
        const LayoutDashboard = (p) => <Icon name="layout-dashboard" {...p} />;
        const ArrowUpRight = (p) => <Icon name="arrow-up-right" {...p} />;
        const ArrowDownRight = (p) => <Icon name="arrow-down-right" {...p} />;
        const TrendingUp = (p) => <Icon name="trending-up" {...p} />;
        const Activity = (p) => <Icon name="activity" {...p} />;
        const PieChart = (p) => <Icon name="pie-chart" {...p} />;
        const Menu = (p) => <Icon name="menu" {...p} />;
        const X = (p) => <Icon name="x" {...p} />;
        const Bitcoin = (p) => <Icon name="bitcoin" {...p} />;
        const Zap = (p) => <Icon name="zap" {...p} />;
        const Box = (p) => <Icon name="box" {...p} />;
        const Layers = (p) => <Icon name="layers" {...p} />;
        const ArrowLeft = (p) => <Icon name="arrow-left" {...p} />;
        const Maximize2 = (p) => <Icon name="maximize-2" {...p} />;
        const Globe = (p) => <Icon name="globe" {...p} />;
        const ChevronDown = (p) => <Icon name="chevron-down" {...p} />;
        const DollarSign = (p) => <Icon name="dollar-sign" {...p} />;
        const CreditCard = (p) => <Icon name="credit-card" {...p} />;
        const Send = (p) => <Icon name="send" {...p} />;
        const HomeIcon = (p) => <Icon name="home" {...p} />; // Renamed from Home
        const Anchor = (p) => <Icon name="anchor" {...p} />;
        const List = (p) => <Icon name="list" {...p} />;
        const Hexagon = (p) => <Icon name="hexagon" {...p} />;
        const Copy = (p) => <Icon name="copy" {...p} />;
        const Gauge = (p) => <Icon name="gauge" {...p} />;
        const CandlestickChart = (p) => <Icon name="candlestick-chart" {...p} />;

        // --- 3. INTRO VIDEO COMPONENT ---
        const IntroOverlay = ({ onComplete }) => {
          const [isFading, setIsFading] = useState(false);

          const handleVideoEnd = () => {
            setIsFading(true);
            setTimeout(() => {
              onComplete();
            }, 1000); 
          };

          return (
            <div className={`video-overlay ${isFading ? 'fading' : ''}`}>
              <video autoPlay muted playsInline onEnded={handleVideoEnd}>
                <source src="FINAL.mp4" type="video/mp4" />
              </video>
              <button onClick={handleVideoEnd} className="absolute bottom-8 right-8 text-white border border-white px-4 py-2 rounded z-50">
                Skip Intro
              </button>
            </div>
          );
        };

        // --- 4. YOUR APP CONSTANTS & DATA ---
        
        const COLORS = {
          bg: '#F7E1B5',      
          text: '#012258',    
          positive: '#008E9B', 
          negative: '#F85F26',
          hover: '#F8B373',
        };

        const COINS = [
          { id: 'PXL', name: 'PixelCoin', price: 420.69, change: 5.4, vol: '2.1M', icon: Box, description: "The original currency of the 8-bit metaverse." },
          { id: 'BIT', name: '8-Bit Cash', price: 12.40, change: -2.1, vol: '890K', icon: Layers, description: "A layered scaling solution for arcade transactions." },
          { id: 'CRT', name: 'Cathode', price: 0.85, change: 12.8, vol: '5.4M', icon: Zap, description: "Powering the next generation of CRT displays." },
          { id: 'ARC', name: 'ArcadeBlock', price: 105.20, change: -0.5, vol: '1.2M', icon: Activity, description: "Proof-of-Play consensus mechanism." },
          { id: 'NES', name: 'Cartridge', price: 3.50, change: 1.2, vol: '300K', icon: Bitcoin, description: "Blowing on the cartridge fixes transaction errors." },
        ];

        const USD_ASSET = { 
          id: 'USD', 
          name: 'US Dollar', 
          price: 1.0, 
          icon: DollarSign, 
          description: "United States Dollar." 
        };

        const WHALE_DATA = {
          'PXL': [
            { id: 'w1', name: 'Satoshi8Bit', amount: '1.2M', size: 80, color: COLORS.positive, x: 30, y: 40 },
            { id: 'w2', name: 'PixelBaron', amount: '890K', size: 65, color: COLORS.negative, x: 70, y: 30 },
            { id: 'w3', name: 'RetroFund', amount: '500K', size: 55, color: COLORS.hover, x: 50, y: 60 },
            { id: 'w4', name: '0xMask', amount: '320K', size: 45, color: COLORS.text, x: 20, y: 70 },
            { id: 'w5', name: 'GlitchWhale', amount: '210K', size: 40, color: COLORS.positive, x: 80, y: 70 },
          ],
          'BIT': [
            { id: 'w1', name: 'LayerKing', amount: '5.5M', size: 90, color: COLORS.hover, x: 50, y: 50 },
            { id: 'w2', name: 'CashNode', amount: '2.1M', size: 60, color: COLORS.positive, x: 25, y: 30 },
            { id: 'w3', name: 'Miner49er', amount: '1.8M', size: 55, color: COLORS.text, x: 75, y: 35 },
            { id: 'w4', name: 'BitVault', amount: '900K', size: 45, color: COLORS.negative, x: 35, y: 75 },
          ],
          'CRT': [
            { id: 'w1', name: 'HighVoltage', amount: '12M', size: 85, color: COLORS.negative, x: 40, y: 40 },
            { id: 'w2', name: 'AnalogDeFi', amount: '8M', size: 70, color: COLORS.positive, x: 70, y: 60 },
            { id: 'w3', name: 'TubeTrader', amount: '4M', size: 50, color: COLORS.hover, x: 20, y: 50 },
            { id: 'w4', name: 'Static', amount: '2M', size: 40, color: COLORS.text, x: 60, y: 20 },
            { id: 'w5', name: 'Scanline', amount: '1.5M', size: 35, color: COLORS.hover, x: 85, y: 80 },
          ],
          'ARC': [
            { id: 'w1', name: 'PlayerOne', amount: '50M', size: 95, color: COLORS.positive, x: 50, y: 50 },
            { id: 'w2', name: 'GameMaster', amount: '12M', size: 60, color: COLORS.text, x: 20, y: 20 },
            { id: 'w3', name: 'TokenOp', amount: '8M', size: 50, color: COLORS.negative, x: 80, y: 20 },
            { id: 'w4', name: 'InsertCoin', amount: '5M', size: 45, color: COLORS.hover, x: 20, y: 80 },
            { id: 'w5', name: 'ComboBreaker', amount: '4M', size: 40, color: COLORS.hover, x: 80, y: 80 },
          ],
          'NES': [
            { id: 'w1', name: 'BlowCart', amount: '250K', size: 75, color: COLORS.text, x: 30, y: 50 },
            { id: 'w2', name: 'DustCover', amount: '180K', size: 65, color: COLORS.positive, x: 70, y: 40 },
            { id: 'w3', name: 'PinConnector', amount: '100K', size: 50, color: COLORS.negative, x: 50, y: 80 },
            { id: 'w4', name: 'RegionLock', amount: '50K', size: 40, color: COLORS.hover, x: 80, y: 70 },
          ]
        };

        // --- 5. HELPER FUNCTIONS ---

        const generatePortfolioData = (range) => {
          const endPrice = 12450;
          let points = 12;
          let variance = 0.02;
          let labels = [];
          let interval = '';

          switch(range) {
            case '1H':
              points = 12; 
              variance = 0.005;
              interval = '5m';
              // Generate labels for last hour
              const now = new Date();
              for(let i=11; i>=0; i--) {
                const d = new Date(now.getTime() - i * 5 * 60000);
                labels.push(d.getHours() + ':' + (d.getMinutes()<10?'0':'') + d.getMinutes());
              }
              break;
            case '1D':
              points = 24; 
              variance = 0.015;
              interval = '1h';
              for(let i=23; i>=0; i-=2) { // Every 2 hours for label density
                 labels.push((i < 10 ? '0'+i : i) + ':00');
              }
              // We need 24 points but maybe fewer labels. 
              // Let's just generate labels for all points and filter in chart if needed, 
              // or just generate 12 labels for 24 points.
              labels = [];
              for(let i=23; i>=0; i--) {
                 labels.push(i + ':00');
              }
              break;
            case '1W':
              points = 7;
              variance = 0.05;
              interval = '1d';
              const days = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
              const today = new Date().getDay();
              for(let i=6; i>=0; i--) {
                labels.push(days[(today - i + 7) % 7]);
              }
              break;
            case '1M':
              points = 30;
              variance = 0.1;
              interval = '1d';
              for(let i=29; i>=0; i-=3) { // Every 3 days
                 const d = new Date();
                 d.setDate(d.getDate() - i);
                 labels.push((d.getMonth()+1) + '/' + d.getDate());
              }
              // Adjust points to match label logic or just pass all labels
              labels = [];
              for(let i=29; i>=0; i--) {
                 const d = new Date();
                 d.setDate(d.getDate() - i);
                 labels.push((d.getMonth()+1) + '/' + d.getDate());
              }
              break;
            case '1Y':
              points = 12;
              variance = 0.25;
              interval = '1mo';
              const months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
              const thisMonth = new Date().getMonth();
              for(let i=11; i>=0; i--) {
                labels.push(months[(thisMonth - i + 12) % 12]);
              }
              break;
            default:
              points = 10;
          }

          let data = [];
          let currentClose = endPrice;

          // Work backwards
          for (let i = 0; i < points; i++) {
             // Random move
             const move = (Math.random() - 0.5) * variance * currentClose;
             const close = currentClose;
             const open = close - move;
             
             // High/Low
             const high = Math.max(open, close) + Math.random() * Math.abs(move) * 0.5;
             const low = Math.min(open, close) - Math.random() * Math.abs(move) * 0.5;

             data.unshift({ open, close, high, low });
             
             // Next iteration (going backwards)
             currentClose = open; 
          }

          return { data, labels };
        };

        const getMockCoinData = (coinId, basePrice, range) => {
          const seedString = coinId + range;
          let seed = 0;
          for (let i = 0; i < seedString.length; i++) {
            seed = ((seed << 5) - seed) + seedString.charCodeAt(i);
            seed |= 0;
          }
          
          let state = Math.abs(seed);
          const seededRandom = () => {
              state = (state * 9301 + 49297) % 233280;
              return state / 233280;
          };

          let points = 6;
          let variance = 0.02;
          let labels = [];
          
          switch(range) {
            case '1H':
              points = 12; 
              variance = 0.015;
              labels = ['00m', '05m', '10m', '15m', '20m', '25m', '30m', '35m', '40m', '45m', '50m', '55m'];
              break;
            case '24H':
              points = 12; 
              variance = 0.05;
              labels = ['00:00', '02:00', '04:00', '08:00', '12:00', '14:00', '16:00', '18:00', '20:00', '21:00', '22:00', '23:00'];
              break;
            case '1W':
              points = 7;
              variance = 0.12;
              labels = ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'];
              break;
            case '1M':
              points = 10;
              variance = 0.25;
              labels = ['W1', 'W2', 'W3', 'W4', 'W5', 'W6', 'W7', 'W8', 'W9', 'W10'];
              break;
            case '1Y':
              points = 12;
              variance = 0.60;
              labels = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
              break;
            default:
              points = 10;
              labels = [];
          }

          const data = [basePrice * (1 - (seededRandom() * variance))];
          for (let i = 1; i < points; i++) {
            const prev = data[i-1];
            const trend = (seededRandom() > 0.48) ? 1 : -1;
            const move = seededRandom() * variance * basePrice * 0.5 * trend;
            data.push(prev + move);
          }
          
          const lastVal = data[data.length - 1];
          const ratio = basePrice / lastVal;
          const adjustedData = data.map(d => d * ratio);

          const startPrice = adjustedData[0];
          const currentPrice = adjustedData[adjustedData.length - 1];
          const changeVal = currentPrice - startPrice;
          const changePercent = ((changeVal / startPrice) * 100).toFixed(2);
          const isUp = changeVal >= 0;
          
          const high = Math.max(...adjustedData);
          const low = Math.min(...adjustedData);
          
          const baseVol = 1000000; 
          const volMultiplier = range === '1H' ? 0.04 : range === '24H' ? 1 : range === '1W' ? 7.5 : range === '1M' ? 32 : 365;
          const vol = (baseVol * volMultiplier * (0.5 + seededRandom()));
          const volStr = vol > 1000000000 ? (vol/1000000000).toFixed(2) + 'B' : (vol/1000000).toFixed(1) + 'M';

          return {
            data: adjustedData,
            labels,
            changePercent: (isUp ? '+' : '') + changePercent + '%',
            isUp,
            high,
            low,
            volume: volStr
          };
        };

        // --- 6. UI COMPONENTS ---

        const HardShadowCard = ({ children, className = "", noPadding = false, onClick, hoverEffect = true }) => (
          <div 
            onClick={onClick}
            className={`
              relative bg-[#F7E1B5] border-2 border-[#012258] rounded-2xl shadow-[6px_6px_0px_#012258] 
              ${hoverEffect ? 'transition-transform hover:-translate-y-1 hover:shadow-[8px_8px_0px_#012258]' : ''} 
              ${onClick ? 'cursor-pointer active:translate-y-1 active:shadow-[4px_4px_0px_#012258]' : ''}
              ${className}
            `}
          >
            <div className={noPadding ? "" : "p-6"}>
              {children}
            </div>
          </div>
        );

        const RetroButton = ({ children, onClick, variant = 'primary', className = "", active = false }) => {
          const baseClasses = "relative px-6 py-3 font-bold rounded-xl border-2 border-[#012258] shadow-[4px_4px_0px_#012258] active:translate-x-[2px] active:translate-y-[2px] active:shadow-[2px_2px_0px_#012258] transition-all uppercase tracking-wide text-sm flex items-center justify-center gap-2";
          
          const variants = {
            primary: "bg-[#012258] text-white hover:bg-[#F8B373] hover:text-[#012258]",
            accent: "bg-[#008E9B] text-white hover:bg-[#F8B373] hover:text-[#012258]",
            secondary: "bg-[#F7E1B5] text-[#012258] hover:bg-[#F8B373]",
            ghost: "bg-[#F7E1B5] text-[#012258] hover:bg-[#F8B373]"
          };

          const activeClasses = active ? "translate-x-[2px] translate-y-[2px] shadow-[2px_2px_0px_#012258] bg-[#F8B373] text-[#012258]" : "";

          return (
            <button 
              onClick={onClick}
              className={`${baseClasses} ${variants[variant] || variants.primary} ${activeClasses} ${className}`}
            >
              {children}
            </button>
          );
        };

        const Badge = ({ isUp, value }) => (
          <span className={`
            inline-flex items-center gap-1 px-3 py-1 rounded-full text-xs font-bold border-2 border-[#012258] text-white
            ${isUp ? 'bg-[#008E9B]' : 'bg-[#F85F26]'}
          `}>
            {isUp ? <ArrowUpRight size={14} /> : <ArrowDownRight size={14} />}
            {Math.abs(value)}%
          </span>
        );

        // --- 7. VISUALIZATION COMPONENTS ---

        const SpiderRadarChart = ({ historyData, currentFeeData }) => {
          const size = 300;
          const center = size / 2;
          const radius = size / 2 - 40;
          const axes = Object.keys(historyData);
          const angleSlice = (Math.PI * 2) / axes.length;

          const getCoordinates = (value, index) => {
            const angle = index * angleSlice - Math.PI / 2; 
            const normalizedValue = Math.min(Math.max(value, 0), 100);
            const r = (normalizedValue / 100) * radius;
            return {
              x: center + r * Math.cos(angle),
              y: center + r * Math.sin(angle)
            };
          };

          const createPath = (dataObject) => {
            return axes.map((key, i) => {
              const { x, y } = getCoordinates(dataObject[key], i);
              return `${i === 0 ? 'M' : 'L'}${x},${y}`;
            }).join(' ') + 'Z';
          };

          const gridLevels = [25, 50, 75, 100];

          return (
            <div className="w-full flex justify-center py-4">
              <svg width={size} height={size} className="overflow-visible">
                {gridLevels.map((level) => (
                  <path
                    key={level}
                    d={axes.map((_, i) => {
                      const r = (level / 100) * radius;
                      const angle = i * angleSlice - Math.PI / 2;
                      const x = center + r * Math.cos(angle);
                      const y = center + r * Math.sin(angle);
                      return `${i === 0 ? 'M' : 'L'}${x},${y}`;
                    }).join(' ') + 'Z'}
                    fill="none"
                    stroke="#012258"
                    strokeOpacity="0.2"
                    strokeDasharray="4 4"
                  />
                ))}

                {axes.map((key, i) => {
                  const { x, y } = getCoordinates(100, i);
                  return (
                    <g key={key}>
                      <line x1={center} y1={center} x2={x} y2={y} stroke="#012258" strokeOpacity="0.2" />
                      <text 
                        x={x * 1.15 - center * 0.15} 
                        y={y * 1.15 - center * 0.15} 
                        textAnchor="middle" 
                        className="text-[10px] fill-[#012258] font-bold font-mono"
                      >
                        {key}
                      </text>
                    </g>
                  );
                })}

                <path
                  d={createPath(historyData)}
                  fill="#012258"
                  fillOpacity="0.2"
                  stroke="#012258"
                  strokeWidth="2"
                />
                {axes.map((key, i) => {
                  const { x, y } = getCoordinates(historyData[key], i);
                  return <circle key={`h-${i}`} cx={x} cy={y} r="3" fill="#012258" />;
                })}

                <path
                  d={createPath(currentFeeData)}
                  fill="#008E9B"
                  fillOpacity="0.4"
                  stroke="#008E9B"
                  strokeWidth="3"
                />
                {axes.map((key, i) => {
                  const { x, y } = getCoordinates(currentFeeData[key], i);
                  return <circle key={`l-${i}`} cx={x} cy={y} r="4" fill="#008E9B" stroke="#F7E1B5" strokeWidth="1" />;
                })}
              </svg>
            </div>
          );
        };

        const FearAndGreedWheel = ({ value, year }) => {
          const radius = 120;
          const centerX = 150;
          const centerY = 150;
          const strokeWidth = 30;

          const angle = (value / 100) * 180 - 180;
          
          const getCoordinates = (angleInDegrees, r) => {
            const angleInRadians = (angleInDegrees * Math.PI) / 180.0;
            return {
              x: centerX + r * Math.cos(angleInRadians),
              y: centerY + r * Math.sin(angleInRadians),
            };
          };

          const needleTip = getCoordinates(angle, radius - 10);
          const needleBaseLeft = getCoordinates(angle - 90, 5);
          const needleBaseRight = getCoordinates(angle + 90, 5);

          return (
            <div className="flex flex-col items-center">
              <svg width="300" height="180" className="overflow-visible">
                <defs>
                  <linearGradient id="wheelGradient" x1="0%" y1="0%" x2="100%" y2="0%">
                    <stop offset="0%" stopColor="#F85F26" />
                    <stop offset="50%" stopColor="#F8B373" />
                    <stop offset="100%" stopColor="#008E9B" />
                  </linearGradient>
                </defs>
                
                <path
                  d="M 30 150 A 120 120 0 0 1 270 150"
                  fill="none"
                  stroke="#012258"
                  strokeWidth={strokeWidth + 4}
                  strokeLinecap="butt"
                  opacity="0.2"
                />
                
                <path
                  d="M 30 150 A 120 120 0 0 1 270 150"
                  fill="none"
                  stroke="url(#wheelGradient)"
                  strokeWidth={strokeWidth}
                  strokeLinecap="butt"
                />

                <path 
                  d={`M ${centerX} ${centerY} L ${needleBaseLeft.x} ${needleBaseLeft.y} L ${needleTip.x} ${needleTip.y} L ${needleBaseRight.x} ${needleBaseRight.y} Z`}
                  fill="#012258"
                />
                <circle cx={centerX} cy={centerY} r="8" fill="#012258" />

                <text x="30" y="180" textAnchor="start" className="text-xs font-bold fill-[#012258] uppercase">Ext. Fear</text>
                <text x="150" y="110" textAnchor="middle" className="text-4xl font-black fill-[#012258]">{value}</text>
                <text x="270" y="180" textAnchor="end" className="text-xs font-bold fill-[#012258] uppercase">Ext. Greed</text>
                <text x="150" y="170" textAnchor="middle" className="text-sm font-bold fill-[#012258] uppercase opacity-60">Year: {year}</text>
              </svg>
              <div className="text-[#012258] font-bold text-lg mt-4 uppercase tracking-widest">
                {value < 25 ? "Extreme Fear" : value < 45 ? "Fear" : value < 55 ? "Neutral" : value < 75 ? "Greed" : "Extreme Greed"}
              </div>
            </div>
          );
        };

        const WhaleBubbleChart = ({ coinId }) => {
          const containerRef = useRef(null);
          const [bubbles, setBubbles] = useState([]);
          const [draggingId, setDraggingId] = useState(null);
          const [offset, setOffset] = useState({ x: 0, y: 0 });

          useEffect(() => {
            const initialData = WHALE_DATA[coinId] || [];
            setBubbles(initialData.map(b => ({ ...b, currentX: b.x, currentY: b.y })));
          }, [coinId]);

          const handleMouseDown = (e, id, startX, startY) => {
            e.stopPropagation();
            setDraggingId(id);
            setOffset({ x: e.clientX, y: e.clientY });
          };

          const handleMouseMove = (e) => {
            if (draggingId && containerRef.current) {
              const rect = containerRef.current.getBoundingClientRect();
              const deltaX = (e.clientX - offset.x) / rect.width * 100;
              const deltaY = (e.clientY - offset.y) / rect.height * 100;

              setBubbles(prev => prev.map(b => {
                if (b.id === draggingId) {
                  return { ...b, currentX: b.currentX + deltaX, currentY: b.currentY + deltaY };
                }
                return b;
              }));
              
              setOffset({ x: e.clientX, y: e.clientY });
            }
          };

          const handleMouseUp = () => {
            setDraggingId(null);
          };

          return (
            <div 
              ref={containerRef}
              className="w-full h-[400px] relative bg-[#F7E1B5] border-2 border-[#012258] rounded-xl overflow-hidden cursor-crosshair"
              onMouseMove={handleMouseMove}
              onMouseUp={handleMouseUp}
              onMouseLeave={handleMouseUp}
            >
              <div className="absolute inset-0 opacity-10 pointer-events-none" 
                   style={{ 
                     backgroundImage: `radial-gradient(#012258 2px, transparent 2px)`,
                     backgroundSize: '20px 20px' 
                   }} 
              />

              <style>
                {`
                  @keyframes float {
                    0% { transform: translate(-50%, -50%) translateY(0px); }
                    50% { transform: translate(-50%, -50%) translateY(-10px); }
                    100% { transform: translate(-50%, -50%) translateY(0px); }
                  }
                  .animate-float {
                    animation: float 4s ease-in-out infinite;
                  }
                `}
              </style>

              {bubbles.map((bubble) => (
                <div
                  key={bubble.id}
                  onMouseDown={(e) => handleMouseDown(e, bubble.id, bubble.currentX, bubble.currentY)}
                  className={`absolute rounded-full border-2 border-[#012258] flex flex-col items-center justify-center text-center shadow-[4px_4px_0px_rgba(1,34,88,0.2)] cursor-move select-none transition-transform ${draggingId === bubble.id ? 'scale-110 z-50' : 'hover:scale-105 z-10 animate-float'}`}
                  style={{
                    left: `${bubble.currentX}%`,
                    top: `${bubble.currentY}%`,
                    width: `${bubble.size * 2}px`,
                    height: `${bubble.size * 2}px`,
                    backgroundColor: bubble.color,
                    transform: 'translate(-50%, -50%)',
                    color: bubble.color === COLORS.text ? '#FDFBF7' : '#012258', 
                    animationDelay: `${Math.random() * 2}s`, 
                    transition: draggingId === bubble.id ? 'none' : 'transform 0.2s, width 0.2s, height 0.2s'
                  }}
                >
                  <span className="font-black text-xs uppercase leading-tight">{bubble.name}</span>
                  <span className="font-mono text-[10px] opacity-80">{bubble.amount}</span>
                </div>
              ))}
            </div>
          );
        };

        const RetroCandlestickChart = ({ data, labels, height = 200 }) => {
          const [hoverIndex, setHoverIndex] = useState(null);
          const containerRef = useRef(null);

          const maxVal = Math.max(...data.map(d => d.high));
          const minVal = Math.min(...data.map(d => d.low));
          const range = (maxVal - minVal) * 1.2;
          const bottomBase = minVal - (range * 0.1);

          const getY = (val) => height - ((val - bottomBase) / range) * height;
          
          const handleMouseMove = (e) => {
            if (!containerRef.current) return;
            const rect = containerRef.current.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const width = rect.width;
            // Adjust for padding if necessary, but simple ratio works for now
            const index = Math.floor((x / width) * data.length);
            if (index >= 0 && index < data.length) {
                setHoverIndex(index);
            }
          };

          return (
            <div 
              ref={containerRef}
              className="w-full relative font-mono text-xs select-none cursor-crosshair" 
              style={{ height: height + 30 }} // Add space for X axis
              onMouseMove={handleMouseMove}
              onMouseLeave={() => setHoverIndex(null)}
            >
              {/* Y Axis Labels (Inside Box) */}
              <div className="absolute inset-0 flex flex-col justify-between pointer-events-none z-20 px-4 py-2">
                {[...Array(5)].map((_, i) => (
                  <div key={i} className="w-full border-t border-dashed border-[#012258]/20 relative h-0">
                    <span className="absolute -top-3 left-0 bg-[#F7E1B5]/80 px-1 text-[#012258] opacity-60 font-bold text-[10px]">
                       ${(maxVal - (i * (range/4))).toFixed(0)}
                    </span>
                  </div>
                ))}
              </div>

              <div className="absolute inset-0" style={{ bottom: '30px' }}>
                  <svg className="w-full h-full overflow-visible">
                    {data.map((d, i) => {
                      const x = (i / data.length) * 100 + (50 / data.length); 
                      const openY = getY(d.open);
                      const closeY = getY(d.close);
                      const highY = getY(d.high);
                      const lowY = getY(d.low);
                      const isUp = d.close >= d.open;
                      const color = isUp ? COLORS.positive : COLORS.negative;
                      const isHovered = hoverIndex === i;

                      return (
                        <g key={i} opacity={hoverIndex !== null && !isHovered ? 0.3 : 1}>
                          <line 
                            x1={`${x}%`} 
                            y1={highY} 
                            x2={`${x}%`} 
                            y2={lowY} 
                            stroke={color} 
                            strokeWidth="2" 
                          />
                          <rect
                            x={`calc(${x}% - 6px)`}
                            y={Math.min(openY, closeY)}
                            width="12"
                            height={Math.max(Math.abs(openY - closeY), 2)} 
                            fill={color}
                            stroke="#012258"
                            strokeWidth="1"
                          />
                          {isHovered && (
                             <rect
                                x={`calc(${x}% - 10px)`}
                                y="0"
                                width="20"
                                height={height}
                                fill="#012258"
                                opacity="0.05"
                             />
                          )}
                        </g>
                      )
                    })}
                  </svg>
              </div>

              {/* X Axis Labels */}
              <div className="absolute bottom-0 left-0 w-full flex justify-between px-2 text-[10px] font-bold text-[#012258] opacity-60">
                 {labels.filter((_, i) => i % Math.ceil(labels.length / 6) === 0).map((l, i) => (
                    <span key={i}>{l}</span>
                 ))}
              </div>

              {hoverIndex !== null && (
                <div 
                    className="absolute z-50 bg-[#012258] text-[#F7E1B5] p-3 rounded border-2 border-[#F7E1B5] pointer-events-none shadow-[4px_4px_0px_rgba(0,0,0,0.2)]"
                    style={{ 
                        left: `${(hoverIndex / data.length) * 100 + (50 / data.length)}%`,
                        top: 0,
                        transform: 'translate(-50%, -10%)'
                    }}
                >
                    <div className="font-bold mb-1 text-xs">{labels[hoverIndex]}</div>
                    <div className="grid grid-cols-2 gap-x-4 gap-y-1 text-[10px]">
                        <span className="opacity-60">Open:</span> <span>${data[hoverIndex].open.toFixed(2)}</span>
                        <span className="opacity-60">Close:</span> <span>${data[hoverIndex].close.toFixed(2)}</span>
                        <span className="opacity-60">High:</span> <span className="text-[#008E9B]">${data[hoverIndex].high.toFixed(2)}</span>
                        <span className="opacity-60">Low:</span> <span className="text-[#F85F26]">${data[hoverIndex].low.toFixed(2)}</span>
                    </div>
                </div>
              )}
            </div>
          );
        };

        const RetroAxisChart = ({ data, labels, color, height = 200 }) => {
          const [hoverIndex, setHoverIndex] = useState(null);
          const containerRef = useRef(null);

          const maxVal = Math.max(...data);
          const minVal = Math.min(...data);
          const range = (maxVal - minVal) * 1.2 || 1;
          const bottomBase = minVal - (range * 0.1);

          const getY = (val) => {
            return height - ((val - bottomBase) / range) * height;
          };
          
          const getX = (index) => (index / (data.length - 1)) * 100;

          const points = data.map((val, i) => {
            const x = getX(i); 
            const y = getY(val);
            return `${x},${y}`; 
          });

          const pathD = points.map((p, i) => {
            const [x, y] = p.split(',');
            return `${i === 0 ? 'M' : 'L'} ${x} ${y}`;
          }).join(' ');

          const handleMouseMove = (e) => {
            if (!containerRef.current) return;
            const rect = containerRef.current.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const width = rect.width;
            
            const index = Math.round((x / width) * (data.length - 1));
            const clampedIndex = Math.max(0, Math.min(data.length - 1, index));
            
            setHoverIndex(clampedIndex);
          };

          return (
            <div 
              ref={containerRef}
              className="w-full h-full relative font-mono text-xs select-none cursor-crosshair" 
              style={{ height: height }}
              onMouseMove={handleMouseMove}
              onMouseLeave={() => setHoverIndex(null)}
            >
              <div className="absolute inset-0 flex flex-col justify-between pointer-events-none opacity-20">
                {[...Array(5)].map((_, i) => (
                  <div key={i} className="w-full border-t border-dashed border-[#012258] relative">
                    <span className="absolute -top-3 -left-8 text-[#012258] opacity-100 font-bold">
                       ${(maxVal - (i * (range/4))).toFixed(2)}
                    </span>
                  </div>
                ))}
              </div>

              <svg 
                className="w-full h-full overflow-visible z-10 relative pointer-events-none"
                viewBox={`0 0 100 ${height}`}
                preserveAspectRatio="none"
              >
                <path 
                  d={pathD} 
                  fill="none" 
                  stroke={color} 
                  strokeWidth="3" 
                  vectorEffect="non-scaling-stroke"
                  strokeLinecap="round" 
                  strokeLinejoin="round"
                />
                
                {hoverIndex !== null && (
                  <>
                    <line 
                      x1={getX(hoverIndex)} 
                      y1="0" 
                      x2={getX(hoverIndex)} 
                      y2={height} 
                      stroke="#012258" 
                      strokeWidth="2" 
                      strokeDasharray="4 4"
                      vectorEffect="non-scaling-stroke"
                    />
                    
                    <circle 
                       cx={getX(hoverIndex)} 
                       cy={getY(data[hoverIndex])} 
                       r="6" 
                       fill={color} 
                       stroke="#012258" 
                       strokeWidth="2" 
                       vectorEffect="non-scaling-stroke"
                    />
                  </>
                )}
              </svg>

              {hoverIndex !== null && (
                <div 
                  className="absolute z-20 bg-[#012258] text-[#F7E1B5] p-2 rounded border-2 border-[#F7E1B5] pointer-events-none shadow-[4px_4px_0px_rgba(0,0,0,0.2)]"
                  style={{ 
                    left: `${getX(hoverIndex)}%`,
                    top: getY(data[hoverIndex]) - 40,
                    transform: 'translateX(-50%)',
                    whiteSpace: 'nowrap'
                  }}
                >
                  <div className="font-bold text-sm">${data[hoverIndex].toFixed(2)}</div>
                  <div className="text-[10px] opacity-80 text-center">{labels[hoverIndex]}</div>
                </div>
              )}

              <div className="absolute -bottom-6 w-full flex justify-between text-[#012258] font-bold opacity-60 pointer-events-none">
                {labels.map((l, i) => (
                  <span key={i} className={hoverIndex === i ? "text-[#008E9B] opacity-100 scale-110 transition-transform" : ""}>{l}</span>
                ))}
              </div>
            </div>
          );
        };

        const Sparkline = ({ data, color, width = 120, height = 40 }) => {
          const max = Math.max(...data);
          const min = Math.min(...data);
          const range = max - min;
          
          const points = data.map((val, i) => {
            const x = (i / (data.length - 1)) * width;
            const y = height - ((val - min) / range) * height;
            return `${x},${y}`;
          }).join(' ');

          return (
            <svg width={width} height={height} className="overflow-visible">
              <polyline 
                points={points} 
                fill="none" 
                stroke={color} 
                strokeWidth="3" 
                strokeLinecap="round" 
                strokeLinejoin="round"
              />
              <circle cx={(data.length - 1) * (width / (data.length - 1))} cy={height - ((data[data.length-1] - min) / range) * height} r="4" fill={color} stroke="#012258" strokeWidth="2" />
            </svg>
          );
        };

        const RetroBarChart = ({ data }) => {
          const max = Math.max(...data.map(d => d.val));
          
          return (
            <div className="w-full h-64 flex items-end justify-between gap-2 p-4 border-2 border-[#012258] bg-[#F7E1B5] rounded-xl shadow-[4px_4px_0px_#012258]">
              {data.map((d, i) => (
                <div key={i} className="flex flex-col items-center w-full group">
                  <div 
                    className="w-full bg-[#008E9B] border-2 border-[#012258] rounded-t-md relative transition-all group-hover:bg-[#F8B373]"
                    style={{ height: `${(d.val / max) * 100}%` }}
                  >
                     <div className="opacity-0 group-hover:opacity-100 absolute -top-10 left-1/2 -translate-x-1/2 bg-[#012258] text-white text-xs p-1 rounded whitespace-nowrap z-10">
                       Vol: {d.val}M
                     </div>
                  </div>
                  <span className="text-xs font-bold mt-2 text-[#012258]">{d.label}</span>
                </div>
              ))}
            </div>
          );
        };

        const DonutChart = () => {
          return (
            <div className="relative w-64 h-64 rounded-full border-4 border-[#012258] shadow-[8px_8px_0px_#012258]"
              style={{
                background: `conic-gradient(
                  #008E9B 0% 40%, 
                  #F85F26 40% 65%, 
                  #F8B373 65% 90%, 
                  #F7E1B5 90% 100%
                )`
              }}
            >
              <div className="absolute inset-0 m-auto w-32 h-32 bg-[#F7E1B5] rounded-full border-4 border-[#012258] flex items-center justify-center flex-col">
                <span className="text-xs font-bold text-[#012258] uppercase">Total</span>
                <span className="text-xl font-black text-[#012258]">$12,450</span>
              </div>
            </div>
          );
        };

        // --- 8. PAGE COMPONENTS ---

        const Home = ({ onNavigate, onTabChange }) => (
          <div className="space-y-8 animate-in fade-in duration-500">
            <div className="flex flex-col items-center mb-8">
               <h1 className="text-4xl font-black uppercase text-[#012258] mb-2 tracking-tighter drop-shadow-[2px_2px_0px_#F8B373]">Welcome back, User</h1>
               <p className="font-mono text-[#012258] text-sm opacity-80">Ready to trade some pixels?</p>
            </div>

            <h3 className="text-xl font-black uppercase tracking-wider text-[#012258] mt-8 flex items-center gap-2">
              <Zap size={24} /> Quick Actions
            </h3>
            <div className="grid grid-cols-1 md:grid-cols-2 gap-6 max-w-4xl mx-auto">
               <HardShadowCard 
                  onClick={() => onTabChange('exchange')}
                  className="h-64 md:col-span-2 hover:bg-[#008E9B] group cursor-pointer transition-colors active:scale-95 flex flex-col justify-center items-center"
               >
                  <div className="flex flex-col items-center text-center gap-6">
                     <div className="flex gap-4">
                        <div className="p-5 bg-[#F8B373] rounded-full border-4 border-[#012258] text-[#012258] shadow-[4px_4px_0px_#012258] group-hover:shadow-[4px_4px_0px_white]">
                            <CreditCard size={48} />
                        </div>
                        <div className="p-5 bg-[#F7E1B5] rounded-full border-4 border-[#012258] text-[#012258] shadow-[4px_4px_0px_#012258]">
                            <ArrowRightLeft size={48} />
                        </div>
                     </div>
                     <div>
                        <h4 className="text-2xl font-black uppercase tracking-wider text-[#012258] group-hover:text-white flex items-center justify-center gap-2">
                           <ArrowRightLeft size={24} /> Exchange & Buy
                        </h4>
                        <p className="font-mono opacity-60 mt-2 group-hover:opacity-80 text-[#012258] group-hover:text-white">Swap Tokens or Buy with Card</p>
                     </div>
                  </div>
               </HardShadowCard>

               <HardShadowCard 
                  onClick={() => onTabChange('wallet')}
                  className="h-64 hover:bg-[#F85F26] group cursor-pointer transition-colors active:scale-95 flex flex-col justify-center items-center"
               >
                  <div className="flex flex-col items-center text-center gap-6">
                     <div className="p-5 bg-[#F7E1B5] rounded-full border-4 border-[#012258] text-[#012258] shadow-[4px_4px_0px_#012258]">
                        <PieChart size={48} />
                     </div>
                     <div>
                        <h4 className="text-2xl font-black uppercase tracking-wider text-[#012258] group-hover:text-white flex items-center justify-center gap-2">
                           <PieChart size={24} /> Portfolio
                        </h4>
                        <p className="font-mono opacity-60 mt-2 group-hover:opacity-80 text-[#012258] group-hover:text-white">View Assets</p>
                     </div>
                  </div>
               </HardShadowCard>

               <HardShadowCard 
                  onClick={() => onTabChange('send-receive')}
                  className="h-64 hover:bg-[#F8B373] group cursor-pointer transition-colors active:scale-95 flex flex-col justify-center items-center"
               >
                  <div className="flex flex-col items-center text-center gap-6">
                     <div className="p-5 bg-[#F7E1B5] rounded-full border-4 border-[#012258] text-[#012258] shadow-[4px_4px_0px_#012258]">
                        <Send size={48} />
                     </div>
                     <div>
                        <h4 className="text-2xl font-black uppercase tracking-wider text-[#012258] group-hover:text-white flex items-center justify-center gap-2">
                           <Send size={24} /> Send & Receive
                        </h4>
                        <p className="font-mono opacity-60 mt-2 group-hover:opacity-80 text-[#012258] group-hover:text-white">Transact</p>
                     </div>
                  </div>
               </HardShadowCard>
            </div>
          </div>
        );

        const MARKET_DATA = {
          '1H': {
            data: [2.441, 2.442, 2.445, 2.443, 2.448, 2.450],
            labels: ['10:00', '10:10', '10:20', '10:30', '10:40', '10:50'],
            change: "+0.37%",
            isUp: true
          },
          '24H': {
            data: [2.35, 2.38, 2.41, 2.39, 2.42, 2.45],
            labels: ['00:00', '04:00', '08:00', '12:00', '16:00', '20:00'],
            change: "+4.25%",
            isUp: true
          },
          '1W': {
            data: [2.20, 2.25, 2.32, 2.28, 2.35, 2.40, 2.45],
            labels: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'],
            change: "+11.36%",
            isUp: true
          },
          '1M': {
            data: [2.10, 2.15, 2.22, 2.18, 2.30, 2.35, 2.45],
            labels: ['Wk1', 'Wk2', 'Wk3', 'Wk4', 'Wk5', 'Wk6', 'Wk7'],
            change: "+16.6%",
            isUp: true
          },
          '1Y': {
            data: [1.80, 1.95, 2.00, 2.15, 2.05, 2.20, 2.35, 2.45],
            labels: ['Jan', 'Mar', 'May', 'Jul', 'Sep', 'Nov', 'Jan', 'Mar'],
            change: "+36.1%",
            isUp: true
          }
        };

        const GlobalCapDetail = ({ onBack }) => {
          const [timeRange, setTimeRange] = useState('24H');
          const currentData = MARKET_DATA[timeRange];

          return (
          <div className="animate-in slide-in-from-right duration-500">
            <div className="mb-6 flex items-center gap-4">
               <RetroButton onClick={onBack} variant="ghost" className="pl-4">
                 <ArrowLeft size={20} /> Back
               </RetroButton>
               <h2 className="text-3xl font-black uppercase text-[#012258]">Global Market Analysis</h2>
            </div>

            <HardShadowCard className="mb-8 p-8" noPadding>
              <div className="p-8 bg-[#012258] text-[#F7E1B5] rounded-t-xl border-b-2 border-[#012258]">
                 <div className="flex flex-col md:flex-row justify-between items-start md:items-end gap-4">
                    <div>
                      <h3 className="text-sm font-mono opacity-80 uppercase mb-1 font-bold">Total Market Capitalization</h3>
                      <div className="text-5xl font-black tracking-tight">$2.45 Trillion</div>
                    </div>
                    <div className="flex flex-col items-end w-full md:w-auto">
                      <div className="flex gap-2 mb-4">
                        {['1H', '24H', '1W', '1M', '1Y'].map((range) => (
                          <button
                            key={range}
                            onClick={() => setTimeRange(range)}
                            className={`
                              text-xs font-bold px-3 py-1 rounded border-2 transition-all
                              ${timeRange === range 
                                ? 'bg-[#F7E1B5] text-[#012258] border-[#F7E1B5] shadow-[2px_2px_0px_#008E9B] translate-x-[1px] translate-y-[1px]' 
                                : 'bg-transparent text-[#F7E1B5] border-[#F7E1B5]/30 hover:border-[#F7E1B5] hover:bg-[#F7E1B5]/10'}
                            `}
                          >
                            {range}
                          </button>
                        ))}
                      </div>
                      <div className="flex items-center gap-2 text-[#012258] bg-[#008E9B] px-2 rounded font-bold text-xl mb-1 border-2 border-[#F7E1B5]">
                         {currentData.isUp ? <TrendingUp size={24} color="#F7E1B5"/> : <ArrowDownRight size={24} color="#F7E1B5"/>}
                         <span className="text-[#F7E1B5]">{currentData.change} ({timeRange})</span>
                      </div>
                      <p className="opacity-60 text-sm text-[#F7E1B5]">Long Term Trend: {currentData.isUp ? 'Bullish' : 'Bearish'}</p>
                    </div>
                 </div>
              </div>
              
              <div className="p-8 pl-12 pr-8 bg-[#F7E1B5] rounded-b-xl h-[400px]">
                <RetroAxisChart 
                   data={currentData.data}
                   labels={currentData.labels}
                   color="#008E9B"
                   height={320}
                 />
              </div>
            </HardShadowCard>

            <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
               <HardShadowCard>
                  <h4 className="font-bold text-[#012258] uppercase mb-2">Dominance</h4>
                  <div className="text-2xl font-mono font-bold text-[#008E9B]">BTC: 42%</div>
                  <div className="text-2xl font-mono font-bold text-[#F85F26]">ETH: 18%</div>
                  <p className="mt-2 text-sm opacity-60 text-[#012258]">Bitcoin dominance remains strong despite altcoin surge.</p>
               </HardShadowCard>
               <HardShadowCard>
                  <h4 className="font-bold text-[#012258] uppercase mb-2">24h Volume</h4>
                  <div className="text-2xl font-mono font-bold text-[#012258]">$89.2 Billion</div>
                  <RetroBarChart data={[
                     {label: 'Spot', val: 60}, {label: 'Deriv', val: 90}
                  ]} />
               </HardShadowCard>
               <HardShadowCard>
                  <h4 className="font-bold text-[#012258] uppercase mb-2">DeFi TVL</h4>
                  <div className="text-2xl font-mono font-bold text-[#008E9B]">$56.4 Billion</div>
                  <p className="mt-2 text-sm opacity-60 text-[#012258]">Locked value in decentralized protocols is reaching new annual highs.</p>
               </HardShadowCard>
            </div>
          </div>
          );
        };

        const CoinDetail = ({ coin, onBack }) => {
          const [timeRange, setTimeRange] = useState('24H');
          
          const chartData = useMemo(() => {
            if (!coin) return null;
            return getMockCoinData(coin.id, coin.price, timeRange); 
          }, [coin, timeRange]);

          if (!coin || !chartData) return null;

          return (
            <div className="animate-in slide-in-from-bottom duration-500">
              <div className="mb-6 flex items-center gap-4">
                <RetroButton onClick={onBack} variant="ghost" className="pl-4">
                  <ArrowLeft size={20} /> Back
                </RetroButton>
                <div className="flex items-center gap-3">
                   <div className="p-2 bg-[#F8B373] rounded border-2 border-[#012258] text-[#012258]">
                      <coin.icon size={24} />
                   </div>
                   <h2 className="text-3xl font-black uppercase text-[#012258]">{coin.name}</h2>
                   <span className="font-mono text-xl opacity-60 text-[#012258]">({coin.id})</span>
                </div>
              </div>

              <div className="grid grid-cols-1 lg:grid-cols-3 gap-8">
                <div className="lg:col-span-2 space-y-8">
                   <HardShadowCard className="p-0 overflow-hidden">
                      <div className="p-6 border-b-2 border-[#012258] bg-[#F7E1B5] flex justify-between items-end">
                         <div>
                            <div className="text-4xl font-mono font-bold text-[#012258] mb-2">${coin.price.toFixed(2)}</div>
                            
                            <div className={`
                               inline-flex items-center gap-1 px-3 py-1 rounded-full text-xs font-bold border-2 border-[#012258] mt-2 text-white
                               ${chartData.isUp ? 'bg-[#008E9B]' : 'bg-[#F85F26]'}
                            `}>
                               {chartData.isUp ? <ArrowUpRight size={14} /> : <ArrowDownRight size={14} />}
                               {chartData.changePercent.replace('+','').replace('-','')} ({timeRange})
                            </div>
                         </div>
                         
                         <div className="flex gap-2">
                            {['1H', '24H', '1W', '1M', '1Y'].map(range => (
                              <button 
                                key={range} 
                                onClick={() => setTimeRange(range)}
                                className={`
                                  text-xs font-bold px-3 py-1 border-2 rounded transition-all
                                  ${timeRange === range 
                                    ? 'bg-[#012258] text-white border-[#012258] shadow-[2px_2px_0px_#F8B373]' 
                                    : 'bg-transparent border-[#012258] hover:bg-[#F8B373] hover:text-[#012258] text-[#012258]'}
                                `}
                              >
                                {range}
                              </button>
                            ))}
                         </div>
                      </div>
                      <div className="p-8 pl-10 h-80 bg-[#F7E1B5]">
                         <RetroAxisChart 
                            data={chartData.data}
                            labels={chartData.labels}
                            color={chartData.isUp ? '#008E9B' : '#F85F26'}
                            height={280}
                          />
                      </div>
                   </HardShadowCard>
                   
                   <HardShadowCard>
                     <h3 className="text-xl font-black uppercase mb-4 text-[#012258]">About {coin.name}</h3>
                     <p className="font-mono text-sm leading-relaxed opacity-80 text-[#012258]">
                       {coin.description || "A decentralized digital asset created for the BitPixel ecosystem. Features high-speed transactions and retro-compatibility with legacy financial systems."}
                     </p>
                   </HardShadowCard>
                </div>

                <div className="space-y-6">
                   <HardShadowCard>
                      <h4 className="font-bold text-[#012258] uppercase mb-4 border-b-2 border-[#012258] pb-2">Market Stats</h4>
                      <div className="space-y-4 font-mono text-[#012258]">
                         <div className="flex justify-between">
                            <span className="opacity-60">Market Cap</span>
                            <span className="font-bold">$4.2B</span>
                         </div>
                         
                         <div className="flex justify-between">
                            <span className="opacity-60">Volume ({timeRange})</span>
                            <span className="font-bold">{chartData.volume}</span>
                         </div>
                         <div className="flex justify-between">
                            <span className="opacity-60">Circulating Supply</span>
                            <span className="font-bold">18.4M {coin.id}</span>
                         </div>
                         <div className="flex justify-between">
                            <span className="opacity-60">High ({timeRange})</span>
                            <span className="font-bold text-[#008E9B]">${chartData.high.toFixed(2)}</span>
                         </div>
                         <div className="flex justify-between">
                            <span className="opacity-60">Low ({timeRange})</span>
                            <span className="font-bold text-[#F85F26]">${chartData.low.toFixed(2)}</span>
                         </div>
                      </div>
                   </HardShadowCard>

                   <div className="bg-[#012258] p-6 rounded-2xl border-2 border-[#012258] shadow-[6px_6px_0px_#F8B373] text-white">
                      <h4 className="font-black uppercase mb-4 text-[#F7E1B5]">Trade {coin.id}</h4>
                      <div className="flex justify-between mb-4 text-sm opacity-80">
                         <span>Available:</span>
                         <span>$12,450.00</span>
                      </div>
                      <div className="flex gap-2 mb-4">
                         <input type="number" placeholder="0.00" className="w-full bg-[#012258] border-2 border-white rounded p-2 font-mono text-right outline-none focus:border-[#F8B373] text-white placeholder-white/50" />
                         <div className="flex items-center bg-[#F8B373] text-[#012258] px-3 font-bold rounded border-2 border-white">
                           USD
                         </div>
                      </div>
                      <button className="w-full py-3 bg-[#008E9B] text-white font-bold rounded-lg border-2 border-transparent hover:border-white hover:bg-[#F85F26] hover:text-white transition-all shadow-[2px_2px_0px_#000]">
                         BUY NOW
                      </button>
                   </div>
                </div>
              </div>
            </div>
          );
        };

        const Market = ({ onCoinSelect, onNavigate }) => {
          const [searchTerm, setSearchTerm] = useState('');
          const [selectedWhaleCoin, setSelectedWhaleCoin] = useState('PXL');

          const filteredCoins = COINS.filter(coin => 
            coin.name.toLowerCase().includes(searchTerm.toLowerCase()) || 
            coin.id.toLowerCase().includes(searchTerm.toLowerCase())
          );

          return (
            <div className="space-y-12 animate-in slide-in-from-right-10 duration-500">
              
              <div className="grid grid-cols-1 lg:grid-cols-3 gap-8">
                <div className="lg:col-span-2 relative">
                  <HardShadowCard 
                    onClick={() => onNavigate('global-cap-detail')} 
                    className="h-full flex flex-col justify-between"
                  >
                    <div className="flex justify-between items-start">
                      <div>
                        <h2 className="text-xl font-black uppercase tracking-wider text-[#012258] mb-6 flex items-center gap-2">Market Overview</h2>
                        <p className="text-[#012258] font-mono font-bold inline-block py-1 mb-6">Global Crypto Cap: $2.4 Trillion</p>
                      </div>
                      <Maximize2 className="text-[#012258] opacity-50" />
                    </div>
                    
                    <div className="pl-8 pb-4 pr-2">
                       <RetroAxisChart 
                         data={[1.2, 1.8, 1.5, 2.1, 2.3, 2.8]}
                         labels={['2020', '2021', '2022', '2023', '2024', '2025']}
                         color="#008E9B"
                         height={200}
                       />
                    </div>
                  </HardShadowCard>
                </div>

                <div className="space-y-6">
                  <HardShadowCard onClick={() => onCoinSelect(COINS.find(c => c.name === 'Cathode'))}>
                    <div className="flex justify-between items-start mb-4">
                      <div>
                        <p className="text-xl font-black uppercase tracking-wider text-[#012258]">Top Gainer</p>
                        <h3 className="text-2xl font-black text-[#012258]">Cathode</h3>
                      </div>
                      <div className="p-2 bg-[#008E9B] rounded-lg border-2 border-[#012258] text-white">
                        <Zap size={24} />
                      </div>
                    </div>
                    <div className="flex justify-between items-end">
                       <span className="text-3xl font-mono text-[#012258]">$0.85</span>
                       <Badge isUp={true} value={12.8} />
                    </div>
                  </HardShadowCard>

                  <HardShadowCard onClick={() => onCoinSelect(COINS.find(c => c.name === '8-Bit Cash'))}>
                    <div className="flex justify-between items-start mb-4">
                      <div>
                        <p className="text-xl font-black uppercase tracking-wider text-[#012258]">Top Loser</p>
                        <h3 className="text-2xl font-black text-[#012258]">8-Bit Cash</h3>
                      </div>
                      <div className="p-2 bg-[#F85F26] rounded-lg border-2 border-[#012258] text-white">
                        <Layers size={24} />
                      </div>
                    </div>
                    <div className="flex justify-between items-end">
                       <span className="text-3xl font-mono text-[#012258]">$12.40</span>
                       <Badge isUp={false} value={2.1} />
                    </div>
                  </HardShadowCard>
                </div>
              </div>

              <div>
                <h3 className="text-xl font-black uppercase tracking-wider text-[#012258] mb-6 flex items-center gap-2">
                  <TrendingUp size={24} /> Trending Assets
                </h3>
                <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                  {COINS.slice(0, 4).map((coin) => (
                    <HardShadowCard key={coin.id} onClick={() => onCoinSelect(coin)}>
                      <div className="flex items-center gap-3 mb-4">
                        <coin.icon className="text-[#012258]" />
                        <span className="font-bold text-[#012258]">{coin.name}</span>
                      </div>
                      <div className="mb-4">
                         <div className="text-2xl font-mono font-bold text-[#012258]">${coin.price.toFixed(2)}</div>
                         <div className={`text-sm font-bold ${coin.change > 0 ? 'text-[#008E9B]' : 'text-[#F85F26]'}`}>
                           {coin.change > 0 ? '+' : ''}{coin.change}%
                         </div>
                      </div>
                      <Sparkline 
                        data={[
                          coin.price * 0.9, 
                          coin.price * 0.95, 
                          coin.price * (coin.change > 0 ? 0.92 : 1.05), 
                          coin.price
                        ]} 
                        color={coin.change > 0 ? '#008E9B' : '#F85F26'} 
                        width={200} 
                        height={40} 
                      />
                    </HardShadowCard>
                  ))}
                </div>
              </div>

              <div>
                <div className="flex justify-between items-center mb-6">
                  <h2 className="text-xl font-black uppercase tracking-wider text-[#012258] flex items-center gap-2">
                     <Activity size={24} /> Live Market
                     <div className="w-3 h-3 rounded-full bg-[#008E9B] animate-pulse ml-1" />
                  </h2>
                  <div className="flex gap-2">
                    <input 
                      type="text" 
                      placeholder="Search Coin..." 
                      value={searchTerm}
                      onChange={(e) => setSearchTerm(e.target.value)}
                      className="bg-[#F7E1B5] border-2 border-[#012258] rounded-lg px-4 py-2 font-mono outline-none shadow-[4px_4px_0px_#F8B373] focus:shadow-[2px_2px_0px_#F8B373] focus:translate-x-[2px] focus:translate-y-[2px] transition-all text-[#012258]"
                    />
                    <RetroButton variant="secondary">Filter</RetroButton>
                  </div>
                </div>

                <div className="bg-[#F7E1B5] border-2 border-[#012258] rounded-2xl overflow-hidden shadow-[6px_6px_0px_#012258]">
                  {filteredCoins.length > 0 ? (
                    <table className="w-full text-left border-collapse text-[#012258]">
                      <thead className="bg-[#012258] text-[#F7E1B5]">
                        <tr>
                          <th className="p-4 font-bold uppercase tracking-wider">Asset</th>
                          <th className="p-4 font-bold uppercase tracking-wider text-right">Price</th>
                          <th className="p-4 font-bold uppercase tracking-wider text-right">24h Change</th>
                          <th className="p-4 font-bold uppercase tracking-wider text-right hidden md:table-cell">Volume</th>
                          <th className="p-4 font-bold uppercase tracking-wider hidden lg:table-cell">Trend</th>
                          <th className="p-4 font-bold uppercase tracking-wider text-center">Action</th>
                        </tr>
                      </thead>
                      <tbody className="divide-y-2 divide-[#012258]">
                        {filteredCoins.map((coin) => (
                          <tr key={coin.id} className="hover:bg-[#F8B373]/20 font-mono group cursor-pointer" onClick={() => onCoinSelect(coin)}>
                            <td className="p-4">
                              <div className="flex items-center gap-3">
                                <div className="p-2 bg-[#F8B373] rounded border-2 border-[#012258] text-[#012258]">
                                  <coin.icon size={16} />
                                </div>
                                <div>
                                  <div className="font-bold text-[#012258]">{coin.name}</div>
                                  <div className="text-xs opacity-60 text-[#012258]">{coin.id}</div>
                                </div>
                              </div>
                            </td>
                            <td className="p-4 text-right font-bold">${coin.price.toFixed(2)}</td>
                            <td className="p-4 text-right">
                              <Badge isUp={coin.change > 0} value={coin.change} />
                            </td>
                            <td className="p-4 text-right hidden md:table-cell">{coin.vol}</td>
                            <td className="p-4 hidden lg:table-cell">
                              <div className="w-32">
                                <Sparkline 
                                  data={[10, 20, 15, 25, 22, 30]} 
                                  color={coin.change > 0 ? '#008E9B' : '#F85F26'} 
                                  width={100} 
                                  height={30} 
                                />
                              </div>
                            </td>
                            <td className="p-4 text-center">
                              <button 
                                onClick={(e) => {
                                  e.stopPropagation();
                                  onCoinSelect(coin);
                                }}
                                className="px-4 py-1 bg-[#012258] text-white text-xs font-bold rounded border-2 border-transparent hover:bg-transparent hover:text-[#012258] hover:border-[#012258] transition-colors"
                              >
                                TRADE
                              </button>
                            </td>
                          </tr>
                        ))}
                      </tbody>
                    </table>
                  ) : (
                    <div className="p-8 text-center text-[#012258] font-bold opacity-60">
                      No coins found matching "{searchTerm}"
                    </div>
                  )}
                </div>
              </div>

              <div>
                <h3 className="text-xl font-black uppercase tracking-wider text-[#012258] mb-6 flex items-center gap-2">
                  <Anchor size={24} /> Whale Watch
                </h3>
                <HardShadowCard>
                  <div className="flex flex-col md:flex-row justify-between items-center mb-6 gap-4">
                    <div className="text-[#012258] font-bold text-sm">Select Coin to View Top Holders</div>
                    <div className="flex gap-2 flex-wrap justify-center">
                      {Object.keys(WHALE_DATA).map((coinId) => (
                        <button 
                          key={coinId} 
                          onClick={() => setSelectedWhaleCoin(coinId)}
                          className={`
                            px-4 py-2 rounded-lg border-2 border-[#012258] font-bold text-xs transition-all shadow-[2px_2px_0px_#012258]
                            ${selectedWhaleCoin === coinId ? 'bg-[#012258] text-white translate-x-[1px] translate-y-[1px] shadow-none' : 'bg-[#F7E1B5] text-[#012258] hover:bg-[#F8B373]'}
                          `}
                        >
                          {coinId}
                        </button>
                      ))}
                    </div>
                  </div>
                  
                  <WhaleBubbleChart coinId={selectedWhaleCoin} />
                  
                  <div className="mt-4 text-center text-xs font-mono opacity-60 text-[#012258]">
                    *Bubbles represent relative holding size. Drag to interact.
                  </div>
                </HardShadowCard>
              </div>
            </div>
          );
        };

        const Exchange = ({ state, setState }) => {
          const { fromAmt, payAsset } = state;
          const setFromAmt = (val) => setState(prev => ({ ...prev, fromAmt: val }));
          const setPayAsset = (asset) => setState(prev => ({ ...prev, payAsset: asset }));

          const [receiveAsset, setReceiveAsset] = useState(USD_ASSET);
          const [isPayDropdownOpen, setIsPayDropdownOpen] = useState(false);
          const [isConfirmed, setIsConfirmed] = useState(false);
          const [frozenFeeData, setFrozenFeeData] = useState(null);

          const exchangeRate = payAsset.price / receiveAsset.price;
          const toAmt = (fromAmt * exchangeRate).toFixed(receiveAsset.id === 'USD' ? 2 : 6);

          const handleSwap = () => {
            if (isConfirmed) return;
            const temp = payAsset;
            setPayAsset(receiveAsset);
            setReceiveAsset(temp);
          };
          
          const selectPayAsset = (asset) => {
            if (isConfirmed) return;
            if (asset.id === receiveAsset.id) {
                setReceiveAsset(payAsset); 
            }
            setPayAsset(asset);
            setIsPayDropdownOpen(false);
          };

          const allAssets = [USD_ASSET, ...COINS];

          const historyFees = { 'PXL': 85, 'BIT': 45, 'CRT': 20, 'ARC': 60, 'NES': 30 };
          const currentFee = (fromAmt * 0.01) * 10; 
          
          const calculatedFeeData = {
            'PXL': payAsset.id === 'PXL' ? currentFee : 0,
            'BIT': payAsset.id === 'BIT' ? currentFee : 0,
            'CRT': payAsset.id === 'CRT' ? currentFee : 0,
            'ARC': payAsset.id === 'ARC' ? currentFee : 0,
            'NES': payAsset.id === 'NES' ? currentFee : 0,
          };

          const displayFeeData = isConfirmed ? frozenFeeData : calculatedFeeData;

          const handleConfirm = () => {
            if (!isConfirmed) {
                setFrozenFeeData(calculatedFeeData);
                setIsConfirmed(true);
            }
          };

          return (
            <div className="max-w-2xl mx-auto pt-8 animate-in zoom-in-95 duration-500">
              <HardShadowCard className="bg-[#012258] text-white">
                <h2 className="text-2xl font-black uppercase text-center mb-8 tracking-widest text-[#F7E1B5]">Atomic Swap</h2>
                
                <div className="bg-[#F7E1B5] p-6 rounded-xl border-2 border-[#012258] text-[#012258] mb-4 relative z-20">
                  <label className="text-xs font-bold uppercase opacity-60 block mb-2 text-[#012258]">You Pay</label>
                  <div className="flex justify-between items-center relative">
                    <input 
                      type="number" 
                      value={fromAmt}
                      onChange={(e) => !isConfirmed && setFromAmt(e.target.value)}
                      disabled={isConfirmed}
                      className={`text-4xl font-mono font-bold bg-transparent outline-none w-1/2 text-[#012258] ${isConfirmed ? 'opacity-50 cursor-not-allowed' : ''}`}
                    />
                    
                    <button 
                      onClick={() => !isConfirmed && setIsPayDropdownOpen(!isPayDropdownOpen)}
                      disabled={isConfirmed}
                      className={`flex items-center gap-2 bg-[#F7E1B5] text-[#012258] px-3 py-2 rounded-lg border-2 border-[#012258] transition-colors ${isConfirmed ? 'opacity-50 cursor-not-allowed' : 'hover:bg-[#F8B373]'}`}
                    >
                      <payAsset.icon size={20} />
                      <span className="font-bold">{payAsset.id}</span>
                      <ChevronDown size={16} />
                    </button>

                    {isPayDropdownOpen && (
                      <div className="absolute top-full right-0 mt-2 w-48 bg-[#F7E1B5] border-2 border-[#012258] rounded-xl shadow-[4px_4px_0px_#012258] overflow-hidden max-h-60 overflow-y-auto z-50">
                        {allAssets.map((asset) => (
                          <button
                            key={asset.id}
                            onClick={() => selectPayAsset(asset)}
                            className="w-full flex items-center gap-3 p-3 hover:bg-[#F8B373] hover:text-[#012258] transition-colors text-left text-[#012258]"
                          >
                            <asset.icon size={16} />
                            <span className="font-bold text-sm">{asset.name}</span>
                          </button>
                        ))}
                      </div>
                    )}
                  </div>
                  <p className="text-xs mt-2 opacity-60 text-[#012258]">Balance: {payAsset.id === 'USD' ? '$12,450.00' : payAsset.id === 'PXL' ? '42.00 PXL' : '0.00 ' + payAsset.id}</p>
                </div>

                <div className="flex justify-center -my-8 relative z-30">
                  <button 
                    onClick={handleSwap}
                    disabled={isConfirmed}
                    className={`bg-[#F8B373] p-3 rounded-full border-4 border-[#012258] text-[#012258] shadow-[0px_4px_0px_#012258] transition-transform ${isConfirmed ? 'opacity-50 cursor-not-allowed' : 'hover:scale-110 active:scale-95'}`}
                  >
                    <ArrowRightLeft size={24} />
                  </button>
                </div>

                <div className="bg-[#F7E1B5] p-6 rounded-xl border-2 border-[#012258] text-[#012258] mt-4 z-0 relative">
                  <label className="text-xs font-bold uppercase opacity-60 block mb-2 text-[#012258]">You Receive</label>
                  <div className="flex justify-between items-center">
                    <span className="text-4xl font-mono font-bold text-[#012258]">{toAmt}</span>
                    <div className={`flex items-center gap-2 bg-[#F7E1B5] text-[#012258] px-3 py-2 rounded-lg border-2 border-[#012258] ${isConfirmed ? 'opacity-50' : ''}`}>
                      <receiveAsset.icon size={20} />
                      <span className="font-bold">{receiveAsset.id}</span>
                    </div>
                  </div>
                  <p className="text-xs mt-2 opacity-60 text-[#012258]">
                    1 {payAsset.id} = {exchangeRate.toFixed(6)} {receiveAsset.id}
                  </p>
                </div>

                <RetroButton 
                    onClick={handleConfirm}
                    disabled={isConfirmed}
                    variant="accent" 
                    className={`w-full mt-8 py-4 text-lg bg-[#F8B373] text-[#012258] border-[#012258] shadow-[4px_4px_0px_#012258] ${isConfirmed ? 'opacity-50 cursor-not-allowed' : ''}`}
                >
                  {isConfirmed ? 'SWAP CONFIRMED' : 'CONFIRM SWAP'}
                </RetroButton>
              </HardShadowCard>

              <div className="mt-8">
                <HardShadowCard>
                  <div className="flex justify-between items-center mb-4">
                    <h3 className="text-xl font-black uppercase tracking-wider text-[#012258] flex items-center gap-2">
                      <Hexagon size={24} /> Fee Analysis
                    </h3>
                    <div className="flex gap-4 text-xs font-bold">
                       <div className="flex items-center gap-1 text-[#012258]"><div className="w-3 h-3 bg-[#012258] opacity-20 rounded-full"></div>History</div>
                       <div className="flex items-center gap-1 text-[#008E9B]"><div className="w-3 h-3 bg-[#008E9B] opacity-40 rounded-full"></div>Current</div>
                    </div>
                  </div>
                  <SpiderRadarChart historyData={historyFees} currentFeeData={displayFeeData} />
                </HardShadowCard>
              </div>
            </div>
          );
        }

        const SendReceive = ({ onBack }) => {
          const [mode, setMode] = useState('send'); // 'send' or 'receive'
          const [asset, setAsset] = useState(COINS[0]);
          const [amount, setAmount] = useState('');
          const [address, setAddress] = useState('');
          const [isDropdownOpen, setIsDropdownOpen] = useState(false);

          return (
            <div className="max-w-2xl mx-auto pt-8 animate-in zoom-in-95 duration-500">
               <button onClick={onBack} className="mb-6 flex items-center gap-2 text-[#012258] font-bold hover:underline">
                  <ArrowLeft size={20} /> Back to Home
               </button>

               <HardShadowCard className="bg-[#012258] text-white">
                  <div className="flex justify-center mb-8 bg-[#001a4d] p-1 rounded-full w-fit mx-auto">
                      <button 
                        onClick={() => setMode('send')}
                        className={`px-6 py-2 rounded-full font-bold transition-all ${mode === 'send' ? 'bg-[#F8B373] text-[#012258]' : 'text-white hover:bg-white/10'}`}
                      >
                        SEND
                      </button>
                      <button 
                        onClick={() => setMode('receive')}
                        className={`px-6 py-2 rounded-full font-bold transition-all ${mode === 'receive' ? 'bg-[#008E9B] text-white' : 'text-white hover:bg-white/10'}`}
                      >
                        RECEIVE
                      </button>
                  </div>

                  {mode === 'send' ? (
                    <div className="space-y-6">
                        <div className="bg-[#F7E1B5] p-6 rounded-xl border-2 border-[#012258] text-[#012258] relative">
                            <label className="text-xs font-bold uppercase opacity-60 block mb-2 text-[#012258]">Asset & Amount</label>
                            <div className="flex justify-between items-center">
                                <input 
                                  type="number" 
                                  placeholder="0.00"
                                  value={amount}
                                  onChange={(e) => setAmount(e.target.value)}
                                  className="text-4xl font-mono font-bold bg-transparent outline-none w-1/2 text-[#012258] placeholder-[#012258]/30"
                                />
                                <div className="relative">
                                    <button 
                                      onClick={() => setIsDropdownOpen(!isDropdownOpen)}
                                      className="flex items-center gap-2 bg-[#F7E1B5] text-[#012258] px-3 py-2 rounded-lg border-2 border-[#012258] hover:bg-[#F8B373] transition-colors"
                                    >
                                      <asset.icon size={20} />
                                      <span className="font-bold">{asset.id}</span>
                                      <ChevronDown size={16} />
                                    </button>
                                    {isDropdownOpen && (
                                      <div className="absolute top-full right-0 mt-2 w-48 bg-[#F7E1B5] border-2 border-[#012258] rounded-xl shadow-[4px_4px_0px_#012258] overflow-hidden z-50">
                                        {COINS.map((c) => (
                                          <button
                                            key={c.id}
                                            onClick={() => { setAsset(c); setIsDropdownOpen(false); }}
                                            className="w-full flex items-center gap-3 p-3 hover:bg-[#F8B373] hover:text-[#012258] transition-colors text-left text-[#012258]"
                                          >
                                            <c.icon size={16} />
                                            <span className="font-bold text-sm">{c.name}</span>
                                          </button>
                                        ))}
                                      </div>
                                    )}
                                </div>
                            </div>
                        </div>

                        <div className="bg-[#F7E1B5] p-6 rounded-xl border-2 border-[#012258] text-[#012258]">
                            <label className="text-xs font-bold uppercase opacity-60 block mb-2 text-[#012258]">To Address</label>
                            <div className="flex items-center gap-2">
                                <input 
                                  type="text" 
                                  placeholder="0x..."
                                  value={address}
                                  onChange={(e) => setAddress(e.target.value)}
                                  className="w-full font-mono font-bold bg-transparent outline-none text-[#012258] placeholder-[#012258]/30"
                                />
                                <button className="p-2 hover:bg-[#012258]/10 rounded text-[#012258]">
                                    <Maximize2 size={20} />
                                </button>
                            </div>
                        </div>

                        <RetroButton variant="accent" className="w-full py-4 text-lg bg-[#F8B373] text-[#012258] border-[#012258] shadow-[4px_4px_0px_#012258]">
                           SEND ASSETS
                        </RetroButton>
                    </div>
                  ) : (
                    <div className="flex flex-col items-center text-center space-y-6 py-8">
                        <div className="bg-white p-4 rounded-xl border-4 border-[#012258]">
                            <div className="w-48 h-48 bg-[#012258] pattern-grid-lg opacity-20"></div> 
                        </div>
                        <div>
                            <p className="text-[#F7E1B5] opacity-60 text-sm mb-2">Your {asset.name} Address</p>
                            <div className="bg-[#001a4d] px-4 py-2 rounded-lg font-mono text-sm flex items-center gap-4 border border-[#F7E1B5]/20">
                                <span className="text-[#F7E1B5]">0x71C...9A23</span>
                                <button className="text-[#F8B373] hover:text-white"><Copy size={16} /></button>
                            </div>
                        </div>
                    </div>
                  )}
               </HardShadowCard>
            </div>
          );
        };

        const Analytics = () => {
          const [timelineYear, setTimelineYear] = useState(2025);
          
          const sentimentData = {
            2020: 30, 
            2021: 85, 
            2022: 20, 
            2023: 50, 
            2024: 75, 
            2025: 84  
          };

          return (
          <div className="space-y-8 animate-in fade-in duration-500">
             <div className="flex flex-col gap-8 items-start">
                <div className="w-full">
                   <HardShadowCard>
                      <div className="flex justify-between items-center mb-6">
                        <h3 className="text-xl font-black uppercase tracking-wider text-[#012258] flex items-center gap-2">
                          <Gauge size={24} /> Fear & Greed Index
                        </h3>
                        <span className="font-mono font-bold text-[#012258] border-2 border-[#012258] px-3 py-1 rounded bg-[#F8B373]">
                          {timelineYear}
                        </span>
                      </div>
                      
                      <div className="flex justify-center py-8">
                         <FearAndGreedWheel value={sentimentData[timelineYear]} year={timelineYear} />
                      </div>

                      <div className="mt-8 px-8">
                        <input 
                          type="range" 
                          min="2020" 
                          max="2025" 
                          step="1"
                          value={timelineYear}
                          onChange={(e) => setTimelineYear(parseInt(e.target.value))}
                          className="w-full h-2 bg-[#012258] rounded-lg appearance-none cursor-pointer accent-[#F8B373]"
                        />
                        <div className="flex justify-between text-xs font-bold text-[#012258] mt-2 font-mono">
                          <span>2020</span>
                          <span>2021</span>
                          <span>2022</span>
                          <span>2023</span>
                          <span>2024</span>
                          <span>2025</span>
                        </div>
                      </div>
                   </HardShadowCard>
                </div>

                <div className="w-full grid grid-cols-1 md:grid-cols-2 gap-8">
                  <HardShadowCard>
                     <div className="flex justify-between items-center mb-6">
                        <h3 className="text-xl font-black uppercase tracking-wider text-[#012258] flex items-center gap-2">
                          <BarChart2 size={24} /> Volume (7D)
                        </h3>
                        <div className="flex gap-2">
                           {['1D', '1W', '1M'].map(t => (
                             <button key={t} className={`text-xs font-bold px-2 py-1 border-2 border-[#012258] rounded ${t === '1W' ? 'bg-[#012258] text-white' : 'bg-transparent text-[#012258]'}`}>{t}</button>
                           ))}
                        </div>
                     </div>
                     <RetroBarChart data={[
                       { label: 'Mon', val: 45 },
                       { label: 'Tue', val: 72 },
                       { label: 'Wed', val: 38 },
                       { label: 'Thu', val: 95 },
                       { label: 'Fri', val: 62 },
                       { label: 'Sat', val: 28 },
                       { label: 'Sun', val: 41 },
                     ]} />
                  </HardShadowCard>

                  <HardShadowCard>
                    <h3 className="text-xl font-black uppercase tracking-wider text-[#012258] mb-4 flex items-center gap-2">
                      <Activity size={24} /> Network Activity
                    </h3>
                    <div className="relative h-48 w-full pl-8 pb-6">
                       {/* Y Axis */}
                       <div className="absolute left-0 top-0 bottom-6 flex flex-col justify-between text-[10px] font-bold text-[#012258] opacity-60">
                          <span>100%</span>
                          <span>75%</span>
                          <span>50%</span>
                          <span>25%</span>
                          <span>0%</span>
                       </div>
                       
                       {/* Bars */}
                       <div className="h-full w-full flex items-end gap-1 border-l-2 border-b-2 border-[#012258]/20">
                           {Array.from({length: 24}).map((_, i) => {
                             const h = Math.random() * 80 + 20;
                             return (
                               <div 
                                  key={i} 
                                  className="flex-1 bg-[#012258] hover:bg-[#F8B373] transition-colors rounded-t-sm relative group" 
                                  style={{ height: `${h}%` }}
                               >
                                  <div className="opacity-0 group-hover:opacity-100 absolute -top-8 left-1/2 -translate-x-1/2 bg-[#012258] text-[#F7E1B5] text-[10px] p-1 rounded pointer-events-none whitespace-nowrap z-10">
                                    {Math.round(h)} TPS
                                  </div>
                               </div>
                             )
                           })}
                       </div>

                       {/* X Axis */}
                       <div className="absolute bottom-0 left-8 right-0 flex justify-between text-[10px] font-bold text-[#012258] opacity-60 pt-1">
                          <span>00:00</span>
                          <span>06:00</span>
                          <span>12:00</span>
                          <span>18:00</span>
                          <span>23:59</span>
                       </div>
                    </div>
                  </HardShadowCard>
                </div>
             </div>
          </div>
          );
        };

        const WalletPage = () => {
          const [portfolioRange, setPortfolioRange] = useState('1M');
          const { data: portfolioData, labels: portfolioLabels } = useMemo(() => generatePortfolioData(portfolioRange), [portfolioRange]);

          return (
          <div className="space-y-8 animate-in slide-in-from-bottom-4 duration-500">
            <div className="grid grid-cols-1 md:grid-cols-2 gap-8">
                <HardShadowCard className="flex flex-col items-center justify-center bg-[#F7E1B5]">
                   <h3 className="text-xl font-black uppercase tracking-wider text-[#012258] mb-8 flex items-center gap-2">
                     <PieChart size={24} /> Asset Allocation
                   </h3>
                   <DonutChart />
                   <div className="mt-8 grid grid-cols-2 gap-4 w-full">
                      <div className="flex items-center gap-2">
                         <div className="w-4 h-4 bg-[#008E9B] border-2 border-[#012258]"></div>
                         <span className="font-bold text-sm text-[#012258]">PixelCoin (40%)</span>
                      </div>
                      <div className="flex items-center gap-2">
                         <div className="w-4 h-4 bg-[#F85F26] border-2 border-[#012258]"></div>
                         <span className="font-bold text-sm text-[#012258]">Cathode (25%)</span>
                      </div>
                      <div className="flex items-center gap-2">
                         <div className="w-4 h-4 bg-[#F8B373] border-2 border-[#012258]"></div>
                         <span className="font-bold text-sm text-[#012258]">Arcade (25%)</span>
                      </div>
                      <div className="flex items-center gap-2">
                         <div className="w-4 h-4 bg-[#F7E1B5] border-2 border-[#012258]"></div>
                         <span className="font-bold text-sm text-[#012258]">USD (10%)</span>
                      </div>
                   </div>
                </HardShadowCard>

                <div className="space-y-6">
                  <HardShadowCard className="bg-[#F7E1B5] text-[#012258]">
                     <div className="flex justify-between items-center mb-4 opacity-80">
                        <span className="uppercase tracking-widest text-sm flex items-center gap-2">
                          <Wallet size={18} /> Total Balance
                        </span>
                     </div>
                     <div className="text-4xl font-mono font-bold mb-4">$12,450.00</div>
                     <div className="flex gap-4">
                        <button className="flex-1 py-2 bg-[#008E9B] border-2 border-[#012258] text-white font-bold rounded-lg hover:bg-[#F8B373] hover:text-[#012258] transition-colors shadow-[2px_2px_0px_#012258]">DEPOSIT</button>
                        <button className="flex-1 py-2 bg-transparent border-2 border-[#012258] text-[#012258] font-bold rounded-lg hover:bg-[#F85F26] hover:text-white transition-colors">WITHDRAW</button>
                     </div>
                  </HardShadowCard>

                  <div className="space-y-3">
                     <h3 className="text-xl font-black uppercase tracking-wider text-[#012258] flex items-center gap-2 mb-4">
                        <List size={24} /> Recent Transactions
                     </h3>
                     {[1,2,3].map((i) => (
                       <div key={i} className="flex justify-between items-center p-4 bg-[#F7E1B5] border-2 border-[#012258] rounded-xl shadow-[4px_4px_0px_#012258]">
                          <div className="flex items-center gap-3">
                             <div className={`p-2 rounded border-2 border-[#012258] ${i === 2 ? 'bg-[#F85F26]' : 'bg-[#008E9B]'} text-white`}>
                                {i === 2 ? <ArrowUpRight size={16} /> : <ArrowDownRight size={16} />}
                             </div>
                             <div>
                                <div className="font-bold text-[#012258]">{i === 2 ? 'Sent PXL' : 'Received BIT'}</div>
                                <div className="text-xs opacity-60 text-[#012258]">Today, 10:23 AM</div>
                             </div>
                          </div>
                          <div className="font-mono font-bold text-[#012258]">
                             {i === 2 ? '-' : '+'}${i * 40}.00
                          </div>
                       </div>
                     ))}
                  </div>
                </div>
            </div>

            <HardShadowCard>
                <div className="flex flex-col md:flex-row justify-between items-start md:items-center mb-6 gap-4">
                    <h3 className="text-xl font-black uppercase tracking-wider text-[#012258] flex items-center gap-2">
                    <CandlestickChart size={24} /> Portfolio Performance
                    </h3>
                    <div className="flex bg-[#012258] p-1 rounded-lg gap-1">
                        {['1H', '1D', '1W', '1M', '1Y'].map((range) => (
                            <button
                                key={range}
                                onClick={() => setPortfolioRange(range)}
                                className={`px-3 py-1 rounded text-xs font-bold transition-all ${
                                    portfolioRange === range 
                                    ? 'bg-[#F7E1B5] text-[#012258] shadow-[2px_2px_0px_#F85F26]' 
                                    : 'text-[#F7E1B5] hover:bg-[#F7E1B5]/20'
                                }`}
                            >
                                {range}
                            </button>
                        ))}
                    </div>
                </div>
                <RetroCandlestickChart data={portfolioData} labels={portfolioLabels} height={300} />
            </HardShadowCard>
          </div>
          );
        };

        // --- 9. MAIN APP COMPONENT ---

        const App = () => {
          const [activeTab, setActiveTab] = useState('home');
          const [selectedCoin, setSelectedCoin] = useState(null);
          const [isMenuOpen, setIsMenuOpen] = useState(false);
          
          // Video Intro State
          const [showIntro, setShowIntro] = useState(true);

          const [exchangeState, setExchangeState] = useState({
            fromAmt: 1,
            payAsset: COINS[0] 
          });

          const renderContent = () => {
            if (activeTab === 'global-cap-detail') {
              return <GlobalCapDetail onBack={() => setActiveTab('market')} />;
            }
            if (activeTab === 'coin-detail') {
              return <CoinDetail coin={selectedCoin} onBack={() => setActiveTab('market')} />;
            }

            switch(activeTab) {
              case 'home': 
                return <Home 
                  onNavigate={(view) => setActiveTab(view)} 
                  onCoinSelect={(coin) => {
                    setSelectedCoin(coin);
                    setActiveTab('coin-detail');
                  }}
                  onTabChange={(tab) => setActiveTab(tab)}
                />;
              case 'market': return <Market 
                onNavigate={(view) => setActiveTab(view)}
                onCoinSelect={(coin) => {
                  setSelectedCoin(coin);
                  setActiveTab('coin-detail');
                }} 
              />;
              case 'exchange': return <Exchange state={exchangeState} setState={setExchangeState} />;
              case 'analytics': return <Analytics />;
              case 'wallet': return <WalletPage />;
              case 'send-receive': return <SendReceive onBack={() => setActiveTab('home')} />;
              default: return <Home />;
            }
          };

          return (
            <div className="min-h-screen bg-[#F7E1B5] font-sans selection:bg-[#F8B373] selection:text-[#012258] pb-20">
              
              {/* VIDEO OVERLAY */}
              {showIntro && <IntroOverlay onComplete={() => setShowIntro(false)} />}

              {/* Navbar */}
              <nav className="sticky top-0 z-50 bg-[#F7E1B5] border-b-4 border-[#012258] px-4 py-4 mb-8">
                <div className="max-w-7xl mx-auto flex justify-between items-center">
                  <div className="flex items-center gap-3 cursor-pointer" onClick={() => setActiveTab('home')}>
                     <img src="Bitpixel title.svg" alt="BITPIXEL" className="h-12" />
                  </div>

                  <div className="hidden md:flex gap-4">
                     {['home', 'market', 'exchange', 'analytics', 'wallet'].map((tab) => (
                       <RetroButton 
                         key={tab} 
                         variant={activeTab === tab ? 'primary' : 'ghost'}
                         active={activeTab === tab}
                         onClick={() => setActiveTab(tab)}
                       >
                         {tab === 'home' && <HomeIcon size={18} />}
                         {tab === 'market' && <TrendingUp size={18} />}
                         {tab === 'exchange' && <ArrowRightLeft size={18} />}
                         {tab === 'analytics' && <PieChart size={18} />}
                         {tab === 'wallet' && <Wallet size={18} />}
                         <span className="capitalize">{tab}</span>
                       </RetroButton>
                     ))}
                  </div>

                  <button 
                    className="md:hidden p-2 border-2 border-[#012258] rounded bg-[#F8B373] shadow-[4px_4px_0px_#012258] text-[#012258]"
                    onClick={() => setIsMenuOpen(!isMenuOpen)}
                  >
                    {isMenuOpen ? <X /> : <Menu />}
                  </button>
                </div>

                {isMenuOpen && (
                  <div className="md:hidden absolute top-full left-0 w-full bg-[#F7E1B5] border-b-4 border-[#012258] p-4 flex flex-col gap-4 shadow-xl">
                     {['home', 'market', 'exchange', 'analytics', 'wallet'].map((tab) => (
                       <RetroButton 
                         key={tab} 
                         variant={activeTab === tab ? 'primary' : 'ghost'}
                         className="w-full capitalize"
                         onClick={() => {
                           setActiveTab(tab);
                           setIsMenuOpen(false);
                         }}
                       >
                         {tab}
                       </RetroButton>
                     ))}
                  </div>
                )}
              </nav>

              <main className="max-w-7xl mx-auto px-4 md:px-8">
                {renderContent()}
              </main>

              <footer className="mt-20 border-t-2 border-[#012258] py-8 text-center opacity-60">
                <p className="font-mono text-[#012258] text-sm"> 2025 BITPIXEL LTD. NO FINANCIAL ADVICE.</p>
                <div className="flex justify-center gap-4 mt-4">
                   <div className="w-2 h-2 bg-[#F85F26] rounded-full"></div>
                   <div className="w-2 h-2 bg-[#008E9B] rounded-full"></div>
                   <div className="w-2 h-2 bg-[#F8B373] rounded-full"></div>
                </div>
              </footer>
            </div>
          );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>